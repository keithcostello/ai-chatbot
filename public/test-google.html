<!DOCTYPE html>
<html>
<head>
  <title>Test Login - Google OAuth</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; }
    h1 { color: #1e3a3a; }
    h2 { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
    button { padding: 12px 24px; background: #4285F4; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin: 5px; }
    button:hover { background: #357abd; }
    .secondary { background: #5d8a6b; }
    .secondary:hover { background: #4a7559; }
    #authResult { margin-top: 20px; padding: 15px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; }
    .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
    .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
    .info { background: #cce5ff; border: 1px solid #b8daff; color: #004085; }
    .warning { background: #fff3cd; border: 1px solid #ffeeba; color: #856404; }
    .cookie-display { background: #f5f5f5; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; margin: 10px 0; }
    a.google-btn { display: inline-block; padding: 12px 24px; background: white; color: #444; border: 1px solid #ccc; border-radius: 4px; text-decoration: none; font-size: 16px; }
    a.google-btn:hover { background: #f5f5f5; }
  </style>
</head>
<body>
  <h1>Google OAuth Test</h1>
  <p>This page tests the Google OAuth sign-in flow.</p>

  <h2>Option 1: Direct OAuth Link</h2>
  <p>Click this link to start Google OAuth flow:</p>
  <a href="/api/auth/signin/google?callbackUrl=/test-dashboard.html" class="google-btn">
    Sign in with Google (via Auth.js)
  </a>

  <h2>Option 2: Next-Auth Sign In Page</h2>
  <p>This goes through the standard Auth.js sign-in page:</p>
  <a href="/api/auth/signin?callbackUrl=/test-dashboard.html" class="google-btn">
    Go to Auth.js Sign In
  </a>

  <h2>Auth Status Check</h2>
  <button onclick="checkAuth()" class="secondary">Check /api/auth/me</button>
  <button onclick="checkSession()" class="secondary">Check /api/auth/session</button>
  <div id="authResult"></div>

  <h2>Cookie Status (document.cookie)</h2>
  <p>Shows cookies visible to JavaScript. HttpOnly cookies are hidden for security.</p>
  <div id="cookieDisplay" class="cookie-display">Loading...</div>
  <button onclick="refreshCookies()" class="secondary">Refresh Cookie Display</button>

  <h2>Navigation</h2>
  <button onclick="window.location.href='/test-login.html'" class="secondary">Go to Standard Login Test</button>
  <button onclick="window.location.href='/test-dashboard.html'" class="secondary">Go to Test Dashboard</button>
  <button onclick="window.location.href='/dashboard'" class="secondary">Go to Real Dashboard</button>

  <script>
    // Display cookies on page load
    function refreshCookies() {
      const cookies = document.cookie;
      document.getElementById('cookieDisplay').textContent = cookies || '(No cookies visible to JavaScript - HttpOnly cookies are hidden)';
    }
    refreshCookies();

    // Check custom auth API
    async function checkAuth() {
      const authDiv = document.getElementById('authResult');
      authDiv.className = 'info';
      authDiv.textContent = 'Checking /api/auth/me...';

      try {
        const response = await fetch('/api/auth/me', {
          credentials: 'include'
        });
        const data = await response.json();

        if (response.ok) {
          authDiv.className = 'success';
          authDiv.textContent = '/api/auth/me - AUTHENTICATED!\n\n' + JSON.stringify(data, null, 2);
        } else {
          authDiv.className = 'error';
          authDiv.textContent = '/api/auth/me - NOT AUTHENTICATED (Status ' + response.status + ')\n\n' + JSON.stringify(data, null, 2);
        }
      } catch (err) {
        authDiv.className = 'error';
        authDiv.textContent = '/api/auth/me - ERROR:\n' + err.message;
      }
    }

    // Check Auth.js session endpoint
    async function checkSession() {
      const authDiv = document.getElementById('authResult');
      authDiv.className = 'info';
      authDiv.textContent = 'Checking /api/auth/session...';

      try {
        const response = await fetch('/api/auth/session', {
          credentials: 'include'
        });
        const data = await response.json();

        if (data && Object.keys(data).length > 0) {
          authDiv.className = 'success';
          authDiv.textContent = '/api/auth/session - SESSION EXISTS!\n\n' + JSON.stringify(data, null, 2);
        } else {
          authDiv.className = 'warning';
          authDiv.textContent = '/api/auth/session - NO SESSION\n\n(Empty response indicates no active session)';
        }
      } catch (err) {
        authDiv.className = 'error';
        authDiv.textContent = '/api/auth/session - ERROR:\n' + err.message;
      }
    }
  </script>
</body>
</html>
